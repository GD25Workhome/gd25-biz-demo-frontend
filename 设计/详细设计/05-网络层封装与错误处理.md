# 网络层封装与错误处理
环境说明：本文以 macOS 开发环境为准。

## 目标
- 统一 HTTP 请求、错误规范与鉴权处理，简化上层模块复杂度

## Axios 实例
- `baseURL`：`import.meta.env.VITE_API_BASE_URL`
- 默认 `timeout`：8–15s（视接口性能而定）
- 公共头：`Content-Type: application/json`

## 请求拦截器
- 可选附加：`Authorization: Bearer <token>`（登录后获取）
- 追踪：为每次请求附加 `x-request-id`（可用 `uuid`）便于后端定位

## 响应拦截器
- 统一解析后端响应体与业务码
- 将错误规范化为 `{ code, message, details }` 形式，便于上层展示

## 错误规范
- 网络错误：连接失败、超时、DNS 解析问题 → 提示“网络异常，请稍后重试”
- 业务错误：如 4xx/5xx 携带业务码 → 按码分类提示与处理
- 鉴权错误：401/403 → 触发登录态处理或跳转登录页

## 超时与取消
- 在路由切换或组件卸载时取消未完成请求（`AbortController` 或 Axios `CancelToken`）
- 确保取消后不更新卸载组件的状态

## 重试策略
- 由 React Query 控制：网络错误重试 3 次，指数退避
- 业务错误不重试，直接向用户反馈

## 安全与日志
- 不记录敏感信息（令牌、个人数据）到日志
- 调试信息仅在开发环境启用；生产环境关闭 verbose 日志
