# 开发前环境准备
环境说明：本文所有步骤均在 macOS 下进行开发与联调。

## 目标
- 准备可运行的本地开发环境与依赖安装方案
- 统一环境变量与网络代理配置，保证与后端联调顺畅

## 系统与工具
- 操作系统：macOS（统一以 macOS 为开发环境）
- Node.js：≥ 18（推荐 18 LTS）
- 包管理器：npm（或 pnpm/yarn，本文以 npm 为例）
- 现代浏览器：Chrome ≥ 120（用于调试与性能分析）

## Node 安装与版本管理
- 终端：建议使用 macOS 默认 `zsh`（新版 macOS 默认）
- 安装 nvm（通过 Homebrew）：
  ```bash
  # 如未安装 Xcode Command Line Tools，请先执行
  xcode-select --install

  # 安装 nvm
  brew install nvm
  mkdir -p ~/.nvm
  echo 'export NVM_DIR="$HOME/.nvm"' >> ~/.zshrc
  echo 'source "$(brew --prefix)/opt/nvm/nvm.sh"' >> ~/.zshrc
  source ~/.zshrc

  # 安装并使用 Node 18 LTS
  nvm install 18
  nvm alias default 18
  nvm use 18
  ```
- 验证版本：`node -v` 与 `npm -v`
 - 备用方案（不使用 nvm）：
   ```bash
   brew install node@18
   echo 'export PATH="$(brew --prefix)/opt/node@18/bin:$PATH"' >> ~/.zshrc
   source ~/.zshrc
   ```
 - 注意事项：
   - Apple Silicon (M1/M2/M3) 与 Intel 架构的 Homebrew 前缀不同，使用 `$(brew --prefix)` 可自动适配。
   - 不要使用 `sudo npm` 安装全局包；如需全局工具优先使用 `npx` 或通过 nvm 管理。

## 包管理器与镜像（可选）
- 保持默认 npm registry；如公司网络需要镜像，可设置：
  ```bash
  npm config set registry https://registry.npmmirror.com
  ```
- 还原：`npm config set registry https://registry.npmjs.org`

## 项目依赖安装
> 所有依赖均固定版本，保证一致性与可复现。

### dependencies
- react: 18.2.0
- react-dom: 18.2.0
- axios: 1.7.7
- @tanstack/react-query: 5.50.1
- react-router-dom: 6.26.2
- antd: 5.20.0
- zustand: 4.5.2
- dayjs: 1.11.11
- uuid: 9.0.1

### devDependencies
- vite: 5.4.10
- @vitejs/plugin-react: 4.3.2
- typescript: 5.6.3
- eslint: 8.57.0
- @typescript-eslint/eslint-plugin: 7.17.0
- @typescript-eslint/parser: 7.17.0
- prettier: 3.3.3
- vitest: 1.6.0
- @testing-library/react: 14.1.2
- @testing-library/jest-dom: 6.2.0
- jsdom: 24.1.0

### 安装命令
```bash
npm i react@18.2.0 react-dom@18.2.0 axios@1.7.7 @tanstack/react-query@5.50.1 \
  react-router-dom@6.26.2 antd@5.20.0 zustand@4.5.2 dayjs@1.11.11 uuid@9.0.1

npm i -D vite@5.4.10 @vitejs/plugin-react@4.3.2 typescript@5.6.3 \
  eslint@8.57.0 @typescript-eslint/eslint-plugin@7.17.0 @typescript-eslint/parser@7.17.0 \
  prettier@3.3.3 vitest@1.6.0 @testing-library/react@14.1.2 @testing-library/jest-dom@6.2.0 jsdom@24.1.0
```

## 环境变量配置
- 在项目根目录创建 `.env.local`（不提交到版本库）
- 必填：`VITE_API_BASE_URL` 指向后端地址，如：
  ```env
  VITE_API_BASE_URL=http://localhost:8080
  ```
- 其它：可按需增加 `VITE_APP_NAME`、`VITE_ENABLE_DEBUG` 等配置

## 网络与代理（联调建议）
- 后端若在不同域/端口，需后端开启 CORS 或前端启用 Vite 开发代理：
  - 在 `vite.config.ts` 中配置 `server.proxy` 将 `/api` 代理到后端
  - 保持前端请求以 `/api/...` 为前缀，避免跨域问题
- 若公司网络存在代理，确保 macOS `HTTPS_PROXY/HTTP_PROXY` 环境变量正确设置；必要时在 `.npmrc` 中配置 `proxy` 与 `https-proxy`。

## Vite 开发代理示例（macOS）
```ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: process.env.VITE_API_BASE_URL || 'http://localhost:8080',
        changeOrigin: true,
        secure: false,
        rewrite: (path) => path.replace(/^\/api/, '/api'),
      },
    },
  },
})
```

## VS Code/IDE 建议配置（macOS）
- 安装扩展：ESLint、Prettier、TypeScript ESLint Plugin
- 在 `.vscode/settings.json`（可选）启用格式化：
```json
{
  "editor.formatOnSave": true,
  "eslint.alwaysShowStatus": true,
  "eslint.validate": ["javascript", "typescript", "javascriptreact", "typescriptreact"],
  "prettier.requireConfig": true
}
```
- 在 `package.json`（初始化后）添加脚本：
```json
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "lint": "eslint \"src/**/*.{ts,tsx}\"",
    "typecheck": "tsc --noEmit",
    "format": "prettier --write .",
    "test": "vitest"
  }
}
```

## 安全与规范
- 不在代码中硬编码密钥/令牌；通过环境变量或安全存储获取
- 调试日志仅在开发环境开启；生产环境关闭敏感日志
- 遵循依赖的固定版本策略，避免“漂移”导致不可复现问题

## 常见问题排查（macOS）
- 端口占用：`lsof -i :5173 | awk 'NR>1 {print $2}' | xargs kill -9` 释放端口
- 权限问题：避免使用 `sudo npm`，优先使用 nvm 管理 Node 与包路径
- 证书错误：开发代理 `secure: false` 可忽略自签证书；正式环境应配置可信证书
- Brew 路径：如命令未找到，执行 `echo "eval \"$(/opt/homebrew/bin/brew shellenv)\"" >> ~/.zshrc && source ~/.zshrc`

## 验证步骤
1. 安装依赖后执行：`npm run dev`（完成基础骨架后）
2. 浏览器访问开发地址（默认 `http://localhost:5173`）
3. 通过 DevTools 验证网络请求基地址与代理是否生效
4. 执行 `npm run lint` 与 `npm run typecheck` 验证代码规范与类型检查
